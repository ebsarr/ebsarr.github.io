<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

        
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

        <link href="https://fonts.googleapis.com/css?family=Ubuntu|Ubuntu+Mono" rel="stylesheet"> 

        <title>Function parameters in golang</title>

        <link rel="stylesheet" href="/css/stylesheet.css">
    </head>
    <body>
      <div class="container-fluid">
        <nav class="navbar navbar-expand-md navbar-light">

          
          <span class="navbar-brand mb-0 h1"></span>

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle Navigation" name="button">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-item nav-link " href="/">Home</a>
              
              
              <a class="nav-item nav-link " href="/about/">About</a>
            </div>
          </div>
        </nav>

        <section id="page-title">
          <h1><a href="/">btaars.net</a></h1>
          <span id="author-name">
            <h6><a href="/about/"></a></h6>
          </span>
        </section>


<div class="blog-post">
  <h1>Function parameters in golang</h1>
  <div class="blog-post-subheader">
    <time>28 Aug 2019</time>
  </div>
  <div class="blog-post-content">
    

<p>Today I want to share a simple concept that I found useful when writing functions in go. Before jumping in, I want to talk about context to better illustrate the use case.
<br><br>
A couple of years ago, I developed a simple <a href="https://github.com/ebsarr/packet">CLI tool</a> to interact with <a href="https://www.packet.com/">packet cloud</a> using their <a href="https://github.com/packethost/packngo">go SDK</a> . As you may guess, the CLI tool had to implement all the major operations/functions provided by the cloud, meaning create, start, stop servers, manage the network environment etc &hellip; The first step was to create a function for each operation, and each function would define the options and parameters that would be submitted to the corresponding packet API. I wanted to have these wrapper functions so that the CLI logic would not have to care about how to create the packet client, or how to call the API, but only focus on the user interface, meaning define the CLI parameters, help contents etc&hellip; Below is an example of one of the wrapper functions.</p>

<pre><code class="language-go">func CreateDevice(projectID, hostname, plan, facility, operatingSystem, billingCycle, userData, ipxeScriptURL string, tags []string, spotInstance, alwaysPXE bool, spotPriceMax float64, terminationTime *time.Time, silent bool) error {
	var err error
	// Create the device
	return err
}
</code></pre>

<p>Looking at this code now, I&rsquo;m like, what was I thinking??? I think that a better approach would be to define a struct whose purpose would be to pass the parameters to the function. In fact, the guys at packet actually included in the SDK these structs for most of the API calls that take many options:
<br>Example: here is an illustration with a device create request parameters in a struct</p>

<pre><code class="language-go">// DeviceCreateRequest type used to create a Packet device
type DeviceCreateRequest struct {
	Hostname              string    
	Plan                  string    
	Facility              []string  
	OS                    string    
	BillingCycle          string    
	ProjectID             string    
	UserData              string    
	Storage               string    
	Tags                  []string  
	IPXEScriptURL         string    
	PublicIPv4SubnetSize  int       
	AlwaysPXE             bool      
	HardwareReservationID string    
	SpotInstance          bool      
	SpotPriceMax          float64   
	TerminationTime       *Timestamp
	CustomData            string    
	UserSSHKeys           []string  
	ProjectSSHKeys        []string  
	Features              map[string]string        
	IPAddresses           []IPAddressCreateRequest 
}
</code></pre>

<p>So a refactored <code>CreateDevice</code> wrapper function would look like this:</p>

<pre><code class="language-go">func CreateDevice(p *DeviceCreateRequest) error {
	var err error
	// Create the device
	// We can access the parameters through *DeviceCreateRequest
	return err
}
</code></pre>

<p>In this example, the structs are already included in the SDK, but even if they are not present, I think it still makes sense to create them as needed for the following reasons.</p>

<h4 id="readability">Readability</h4>

<p>Compare the two function declarations to see what I mean. All the function parameters in the first function are difficult to read and also difficult to document. By using a struct, the function declaration can be more consise and easy to read. On top of that, each parameter in the struct can be easily documentated. In the packngo SDK, you can see how some relevant options are documented in the struct:</p>

<pre><code class="language-go">type DeviceCreateRequest struct {
	// Skipping all the other parameters to make illustration
	// shorther

	// UserSSHKeys is a list of user UUIDs - essentialy
	// a list of collaborators. The users must be a collaborator
	// in the same project where the device is created.
	// The user's SSH keys then go to the device.
	UserSSHKeys           []string
	// Project SSHKeys is a list of SSHKeys resource UUIDs.
	// If this param is supplied, only the listed SSHKeys will go
	// to the device.
	// Any other Project SSHKeys and any User SSHKeys will not
	// be present in the device.
	ProjectSSHKeys        []string  
}
</code></pre>

<h4 id="handling-of-default-values">Handling of default values</h4>

<p>The function caller only has to set the parameters(options) that they are interested in. The other ones can be checked and provided with default values inside the function:</p>

<pre><code class="language-go">func CreateDevice(p *DeviceCreateRequest) error {
	var err error
	// Before creating the device, we can set default values
	// when necessary
	if p.OS == &quot;&quot; {
		p.OS = &quot;ubuntu&quot;
	}
	// create the device...
	return err
}
</code></pre>

<p>Then the caller only has to set mandatory options, and let the <code>CreateDevice</code> function set default values when needed:</p>

<pre><code class="language-go">
func main () {
	// Callã€€CreateDevice
	err := CreateDevice(&amp;CreateDeviceRequest{
		Hostname: &quot;create-device-001&quot;,
		// The CreateDevice function can take care of setting
		// default values for all the other parameters.
	})
	if err != nil {
		panic(err)
	}
}
</code></pre>

<p>By comparison, the caller would have to set all the possible options for a device create request in the first function, even though <code>Hostname</code> is the only desired option in this case.</p>

<h4 id="higher-maintainability">Higher maintainability</h4>

<p>With a struct as function parameter, you can easily modify the parameters without changing the function declaration. At least in this case, it is easy to add new optional paramters to create a device, without breaking any code that rely on the <code>CreateDevice</code> function.</p>

<h3 id="conclusion">Conclusion</h3>

<p>I&rsquo;m not sure if this is a definitive best practice, but I found it very usefull to define function paramters in a struct, especially when you have to deal with multiple paramters:</p>

<pre><code class="language-go">// DoSomethingParameters represents the parameters of
// the `DoSomething` function
type DoSomethingParameters struct {
	ParamOne string
	ParamTwo int
}

func DoSomething(p *DoSomethingParameters) error {
	var err error
	// do something
	return err
}
</code></pre>

<p>Well that&rsquo;s it.</p>

  </div>
</div>

      <footer>
        <hr>
        <small>
          &copy; 2022 .
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> using the <a href="https://github.com/arjunkrishnababu96/basics" target="_blank">Basics</a> theme.
        </small>
      </footer>
    </div> 

    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
  </body>
</html>

